<html xmlns='http://www.w3.org/1999/html'>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='cache-control' content='max-age=0'/>
    <meta http-equiv='cache-control' content='no-cache'/>
    <meta http-equiv='expires' content='0'/>
    <meta http-equiv='expires' content='Tue, 01 Jan 1980 1:00:00 GMT'/>
    <meta http-equiv='pragma' content='no-cache'/>
    <meta name='viewport' content='width=device-width, shrink-to-fit=YES, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no'/>
    <title>Simple Model Tool Standalone</title>

	<script src='/userinterface/src/constructors.js'></script>
	<script src='/userinterface/src/states.js'></script>
	<script src='/userinterface/src/index.js'></script>
    <script src="/userinterface/src/gui/webgl-debug.js"></script>
    <script src='/userinterface/src/gui/glRenderer.js' type='module'></script>
	<script>
        /**
         * calculates a projection matrix
         * @param {number} fovDeg 
         * @param {number} near 
         * @param {number} far 
         * @param {number} aspect 
         * @returns {Float32Array} float4x4
         */
        function getProjectionMatrix(fovDeg, near, far, aspect) {
            const fov = 1 / Math.tan((fovDeg * Math.PI) / (180 * 2));
            const rangeInv = 1 / (near - far);
            return new Float32Array([fov / aspect, 0, 0, 0, 0, fov, 0, 0, 0, 0, (near + far) * rangeInv, -1, 0, 0, near * far * rangeInv * 2, 0]);
        }

        // fake certain functionality
		createNameSpace('realityEditor.device');
		createNameSpace('realityEditor.network');
		realityEditor.device.registerCallback = function(str, func) {};
		realityEditor.network.registerCallback = function(str, func) {};
		
		window.onload = () => {
            // load the tool
			globalDOMCache['iframe_standalone_tool'] = document.getElementById('iframe_standalone_tool');
			globalDOMCache['object_standalone_tool'] = document.getElementById('object_standalone_tool');
			realityEditor.gui.glRenderer.initService();
			realityEditor.gui.glRenderer.addWebGlProxy('_standalone_tool');
            
            // setup a projection matrix
            globalDOMCache['iframe_standalone_tool'].contentWindow.postMessage({name: 'anchoredModelViewCallback', projectionMatrix: getProjectionMatrix(60, 1, 1000, globalStates.width / globalStates.height)},'*')
		};
	</script>
</head>
<body>
<canvas id='glcanvas' class='canvas-webgl-proxy'></canvas>
<div id='object_standalone_tool'>
<iframe src='index.html' id='iframe_standalone_tool'></iframe>
</div>
</body>
</html>
